import json

OUTPUT_FILE = "manual/manual_cases.jsonl"

group_white_list = [
    "这是什么东西？",
    "这是什么？",
    "那是什么",
    "哪有你说的这个东西？",
    "好像不太对",
    "他的代码看起来还不错",
    "不对",
    "好的",
    "今天的活动真不错！",
    "今天的活动很不错！",
    "上个月的菜还行",
    "不会吧？这也行？？",
    "真有你的！",
]

# ==============================================================================
# 1. 治愈“误杀”：严肃口号、命令、法律、政策 (Label 0 - Safe)
# 痛点：模型把“坚决打击”、“不信谣”等强硬语气误判为辱骂/暴恐。
# ==============================================================================
group_a_slogans = [
    "坚决打击违法犯罪行为。",
    "深入开展扫黑除恶专项斗争。",
    "网络不是法外之地，请谨言慎行。",
    "自觉做到不信谣、不传谣、不造谣。",
    "富强民主文明和谐，爱国敬业诚信友善。",
    "不管是白猫黑猫，捉住老鼠就是好猫。",
    "严禁随地吐痰，违者罚款。",
    "请勿在公共场所大声喧哗。",
    "根据相关法律法规，您的账号已被封禁。",
    "坚持动态清零不动摇，全力保障人民生命安全。",
    "房子是用来住的，不是用来炒的。",
    "绿水青山就是金山银山。",
    "我们要以此为契机，深化改革开放。",
    "必须坚持党的领导，坚持人民至上。",
    "所有人员请佩戴好口罩，保持一米距离。",
    "严厉查处偷税漏税行为。",
    "增强四个意识，坚定四个自信，做到两个维护。",
    "禁止携带易燃易爆物品进入车站。",
    "依法治国，建设社会主义法治国家。",
    "今天的新闻联播主要内容如下。",
    "请大家排队进行核酸检测。",
    "为了您的安全，请系好安全带。",
    "打击网络谣言，共建清朗空间。",
    "该行为违反了社区公约。",
    "请立即停止您的不当行为。"
]

# ==============================================================================
# 2. 治愈“误杀”：情绪夸张、游戏术语、生活牢骚 (Label 0 - Safe)
# 痛点：模型把“笑死”、“炸了”、“杀”等字眼误判为辱骂/暴恐。
# ==============================================================================
group_b_emotions = [
    "笑死我了，这图太逗了。",
    "饿死我了，中午吃什么？",
    "困死爹了，昨晚加班到三点。",
    "我的电脑突然炸了，文件全没了。",
    "这把游戏我拿了五杀，队友太给力了。",
    "斗地主：我出炸弹，四个二！",
    "如果不吃饭，人是真的会饿死的。",
    "这天气热得我想死。",
    "气死我了，排队排了半小时。",
    "我也太笨了，出门竟然忘带钥匙。",
    "这个Bug真是变态，怎么改都报错。",
    "我恨死香菜了，味道像肥皂。",
    "这游戏太难了，我被虐哭了。",
    "吓死宝宝了，刚才那声雷真响。",
    "你这个小坏蛋，又偷吃零食。",
    "这也太杀马特了，欣赏不来。",
    "我把这只蚊子拍死了。",
    "消毒水可以杀灭99%的细菌。",
    "今天累得像条狗一样。",
    "这道菜辣得变态，但是我喜欢。",
    "虽然他长得丑，但是很温柔。",
    "这系统卡得我想砸键盘。",
    "真是个憨憨，这也信。",
    "我要把这堆垃圾扔掉。",
    "你脑洞真大，不去写小说可惜了。"
]

# ==============================================================================
# 3. 治愈“漏杀”：政治隐喻、短句攻击、特定称呼 (Label 1 - Political)
# 痛点：模型漏掉“加速师”、“倒车”、“推翻”以及短句攻击。
# ==============================================================================
group_c_political = [
    "总加速师正在踩油门。",
    "倒车请注意，倒车请注意。",
    "那位司机要把车开到悬崖里去了。",
    "维尼遨游星汉，我们要完蛋。",
    "庆丰帝登基，万岁万万岁。",
    "包子露宪了。",
    "细颈瓶怎么还不下台？",
    "李强就是个傀儡。",
    "打倒独裁者。",
    "共匪不灭，天理难容。",
    "我们要推翻共产党的统治。",  # 重点特训
    "中共必须谢罪。",
    "天灭中共，三退保平安。",
    "支持香港独立，光复香港。",
    "台湾是一个独立的国家。",
    "新疆集中营是真的。",
    "大纪元新闻：江泽民被捕。",
    "六四屠城，血债血偿。",
    "8964，永不敢忘。",
    "这就是赵家人的嘴脸。",
    "韭菜就要有韭菜的觉悟。",
    "最后一代，谢谢。",
    "通商宽衣，萨格尔王。",
    "扛麦郎不换肩。",
    "XJP step down.",
    "CCP virus.",
    "习近平去死。",
    "李强滚蛋。",
    "共产党下台。",
    "独夫民贼习近平。"
]

# ==============================================================================
# 4. 治愈“漏杀”：短平快色情、辱骂 (Label 2/3 - Porn/Abuse)
# 痛点：短词在没上下文时容易被忽略。
# ==============================================================================
group_d_others = [
    # 色情 (Label 2)
    "约炮。",
    "上门服务。",
    "同城可约。",
    "丝袜足交。",
    "幼女资源。",
    "母狗调教。",
    "想被操。",
    "看看批。",
    "喝茶，懂的来。",
    "外围空降。",
    "裸聊+V。",
    "SM捆绑。",
    "出售原味内裤。",
    
    # 辱骂/暴恐 (Label 3)
    "NMSL",
    "WSND",
    "傻逼",
    "废物",
    "你妈死了",
    "全家暴毙",
    "滚去死",
    "脑残东西",
    "贱人",
    "操你妈",
    "我要杀了你",
    "教你做炸弹",
    "出售迷药",
    "把你全家杀光",
    "去死吧",
    "狗东西"
]

# ==============================================================================
# 5. 自动打标与生成
# ==============================================================================

def auto_ner(text, label_cls):
    """
    为了方便，这里做一个简易的规则NER。
    实际训练中，如果你的模型依赖NER，这里最好手动标一下重点词。
    这里为了代码简洁，仅对部分关键词做简单标注，其余标O。
    """
    labels = ["O"] * len(text)
    
    # 简单的关键词映射 (仅作示例，提升训练效果)
    keywords = {
        # Political
        "习近平": "SENS", "维尼": "SENS", "包子": "SENS", "庆丰帝": "SENS",
        "细颈瓶": "SENS", "李强": "SENS", "共匪": "SENS", "中共": "SENS",
        "共产党": "SENS", "独裁者": "SENS", "六四": "SENS", "8964": "SENS",
        "加速师": "SENS", "倒车": "SENS", "XJP": "SENS", "CCP": "SENS",
        
        # Abuse
        "傻逼": "INS", "脑残": "INS", "贱人": "INS", "NMSL": "INS", 
        "死": "INS", "杀": "INS", "滚": "INS", "操": "INS",
        
        # Porn
        "约炮": "PRN", "上门": "PRN", "幼女": "PRN", "调教": "PRN",
        "裸聊": "PRN", "操": "PRN", "批": "PRN"
    }
    
    # 只有当是负样本时，才去打NER标签
    if label_cls != 0:
        for kw, tag in keywords.items():
            if kw in text:
                start = text.find(kw)
                if start != -1:
                    labels[start] = f"B-{tag}"
                    for i in range(1, len(kw)):
                        labels[start+i] = f"I-{tag}"
    
    return labels

data_list = []

# 处理 手动添加的白名单 (Label 0)
for text in group_white_list:
    data_list.append({"text": text, "label_cls": 0, "label_ner": ["O"] * len(text)})

# 处理 Group A (Label 0)
for text in group_a_slogans:
    data_list.append({"text": text, "label_cls": 0, "label_ner": ["O"] * len(text)})

# 处理 Group B (Label 0)
for text in group_b_emotions:
    data_list.append({"text": text, "label_cls": 0, "label_ner": ["O"] * len(text)})

# 处理 Group C (Label 1)
for text in group_c_political:
    data_list.append({"text": text, "label_cls": 1, "label_ner": auto_ner(text, 1)})

# 处理 Group D (Label 2/3)
for i, text in enumerate(group_d_others):
    # 前13个是色情(Label 2)，后面是辱骂(Label 3)
    lbl = 2 if i < 13 else 3
    data_list.append({"text": text, "label_cls": lbl, "label_ner": auto_ner(text, lbl)})

# 写入文件
with open(OUTPUT_FILE, "w", encoding="utf-8") as f:
    for item in data_list:
        f.write(json.dumps(item, ensure_ascii=False) + "\n")

print(f"✅ 已生成 manual_cases.jsonl，共 {len(data_list)} 条精选特训数据。")
print("   - 包含严肃口号防误杀")
print("   - 包含情绪夸张防误杀")
print("   - 包含政治隐喻/倒车/推翻防漏杀")
print("   - 包含短句脏词防漏杀")
